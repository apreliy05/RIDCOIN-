<script>
  let score = 0;
  let ridcoinBalance = 0;
  const gameArea = document.getElementById('gameArea');
  const scoreDisplay = document.getElementById('score');
  const ridcoinDisplay = document.getElementById('ridcoinBalance');
  const withdrawButton = document.getElementById('withdrawButton');
  const walletButton = document.getElementById('walletButton');
  const networkInfo = document.getElementById('networkInfo');

  let provider;
  let signer;
  let userAddress;
  const tokenAddress = "0xcD36914FD4C560D1475088eB84bB82C11f3E19DE"; // Твой токен
  const tokenABI = [
    "function transfer(address to, uint amount) public returns (bool)"
  ];

  async function connectWallet() {
    if (window.ethereum) {
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      userAddress = await signer.getAddress();

      await checkNetwork();

      document.getElementById('walletAddress').innerText = "Кошелек: " + userAddress;
      alert('Кошелек подключён!');
    } else {
      alert('Установите Trust Wallet или откройте через Web3-браузер!');
    }
  }

  async function checkNetwork() {
    const { chainId } = await provider.getNetwork();
    if (chainId === 137) {
      networkInfo.innerText = "Сеть: Polygon Mainnet";
    } else {
      networkInfo.innerText = "Сеть: не Polygon!";
      try {
        await switchToPolygon();
      } catch (err) {
        console.error(err);
        alert('Переключитесь вручную на Polygon сеть в кошельке!');
      }
    }
  }

  async function switchToPolygon() {
    await window.ethereum.request({
      method: 'wallet_switchEthereumChain',
      params: [{ chainId: '0x89' }], // 0x89 = 137 в 16-ричном
    });
    alert('Сеть переключена на Polygon!');
    networkInfo.innerText = "Сеть: Polygon Mainnet";
  }

  async function sendToWallet() {
    if (!userAddress) {
      alert('Сначала подключите кошелек!');
      return;
    }
    if (ridcoinBalance >= 100) {
      const contract = new ethers.Contract(tokenAddress, tokenABI, signer);
      const amount = ethers.utils.parseUnits("100", 18); // 100 RIDCOIN
      try {
        const tx = await contract.transfer(userAddress, amount);
        await tx.wait();
        alert('RIDCOIN успешно отправлен на ваш кошелек!');
        ridcoinBalance = 0;
        updateScore();
        walletButton.style.display = 'none';
      } catch (error) {
        console.error(error);
        alert('Ошибка при отправке: ' + error.message);
      }
    } else {
      alert('Недостаточно RIDCOIN! Нужно 100.');
    }
  }

  // остальной код игры (создание монет, анимации и начисление очков) оставляем без изменений.
</script>