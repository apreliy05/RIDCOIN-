<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Лови RIDCOIN!</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #000;
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin-top: 30px;
      color: #4682B4;
    }
    p {
      color: #FFD700;
      font-size: 20px;
    }
    #score, #ridcoin {
      font-size: 24px;
      margin: 10px 0;
    }
    #connectButton {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      background-color: #4CAF50;
      border: none;
      border-radius: 10px;
      color: white;
    }
    .coin {
      position: absolute;
      width: 80px;
      height: 80px;
      background-image: url('https://i.ibb.co/9wpg5df/ridcoin.png');
      background-size: cover;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Лови <b>RIDCOIN!</b></h1>
  <p>Собери 10 монет и получи 1 RIDCOIN!<br>Собери 1 RIDCOIN и выведи на свой кошелек!</p>
  <div id="score">Очки: 0</div>
  <div id="ridcoin">RIDCOIN: 0</div>
  <button id="connectButton">Подключить кошелек</button>

  <script>
    let score = 0;
    let ridcoins = 0;
    let signer;
    let provider;
    let userAddress;
    const contractAddress = "0xcD36914FD4C560D1475088eB84bB82C11f3E19DE";
    const tokenAbi = [
      "function transfer(address to, uint amount) public returns (bool)"
    ];

    async function connectWallet() {
      if (window.ethereum) {
        try {
          await ethereum.request({ method: "eth_requestAccounts" });
          provider = new ethers.providers.Web3Provider(window.ethereum);
          signer = provider.getSigner();
          userAddress = await signer.getAddress();
          alert("Кошелек подключен: " + userAddress);
        } catch (error) {
          alert("Ошибка подключения кошелька: " + error.message);
        }
      } else {
        alert("Установите MetaMask!");
      }
    }

    document.getElementById("connectButton").addEventListener("click", connectWallet);

    function createCoin() {
      const coin = document.createElement("div");
      coin.classList.add("coin");
      coin.style.top = Math.random() * (window.innerHeight - 100) + "px";
      coin.style.left = Math.random() * (window.innerWidth - 100) + "px";
      coin.onclick = () => {
        score++;
        document.getElementById("score").innerText = "Очки: " + score;
        coin.remove();

        if (score >= 10) {
          score = 0;
          ridcoins++;
          document.getElementById("score").innerText = "Очки: " + score;
          document.getElementById("ridcoin").innerText = "RIDCOIN: " + ridcoins;
          sendRidcoin();
        }
      };
      document.body.appendChild(coin);
      setTimeout(() => coin.remove(), 5000);
    }

    setInterval(createCoin, 800);

    async function sendRidcoin() {
      if (!signer) {
        alert("Пожалуйста, подключите кошелек сначала!");
        return;
      }

      try {
        const contract = new ethers.Contract(contractAddress, tokenAbi, signer);
        const amount = ethers.utils.parseUnits("1", 18); // 1 RIDCOIN с 18 знаками после запятой
        const tx = await contract.transfer(userAddress, amount);
        await tx.wait();
        alert("1 RIDCOIN успешно отправлен на ваш кошелек!");
      } catch (error) {
        console.error(error);
        alert("Ошибка отправки RIDCOIN: " + error.message);
      }
    }
  </script>
</body>
</html>